<div class="text-input">
	<pre class="textarea" contenteditable spellcheck="false" name="text-input" aria-label="math formula input"></pre>
</div>

<div class="dragger"></div>

<div id="paper-size-measurement"></div>

<div class="print-header-placeholder">&nbsp;</div>

<div id="headers-and-footers">
	<template>
		<div>
			<div class="header">
				<div class="author"></div>
				<div class="title"></div>
				<div class="date"></div>
			</div>
			<div class="footer"></div>
		</div>
	</template>
</div>

<section class="html-output" aria-label="live preview of mathematical document" tabindex="0">
	<div id="content-end-element"></div>
</section>

<div class="print-footer-placeholder">&nbsp;</div>

<style>
	@layer elements {
		& {
			block-size: 100%;
			display: flex;
			box-sizing: border-box;
			background-color: var(--gray-1);
			--dragger-width: 10px;
			--split-proportion: .5;
			--full-length: 100cqi;
			--dragger-cursor: ew-resize;
			container-type: size;

			--page-inline-margin: 5rem;
			--page-top-margin: 7rem;
			--page-bottom-margin: 5rem;
			--page-header-top-offset: 4.5rem;
			--page-footer-bottom-offset: 2.5rem;

			@media (hover: none) {
				--dragger-width: 16px;
			}
		}

		:root[data-editor-layout="stacked"] & {
			flex-direction: column;
			--dragger-cursor: ns-resize;
			--full-length: 100cqb;
		}

		&.dragging {
			cursor: var(--dragger-cursor);
			-webkit-user-select: none;
			user-select: none;
		}

		:root[data-editor-layout="aside"] & .text-input {
			border-start-end-radius: .3rem;
		}
		
		:root[data-editor-layout="aside"] & .html-output {
			border-start-start-radius: .3rem;
		}
		
		:root[data-transition="toggling-layout"] & .text-input {
			view-transition-name: text-input;
		}
		
		:root[data-transition="toggling-layout"] & .html-output {
			view-transition-name: html-output;
		}

		& .text-input {
			flex-grow: 0;
			flex-shrink: 0;
			--clamped-split-proportion: clamp(0, var(--split-proportion), 1);
			flex-basis: calc(var(--clamped-split-proportion) * (var(--full-length) - var(--dragger-width)));
			font-size: 1.1rem;
			background-color: var(--background);
			/* overflow: hidden; */
			contain: layout;
			overflow: auto;

			& .textarea {
				padding: .8rem 1rem;
				resize: none;
				/* inline-size: 100%; */
				/* block-size: 100%; */
				box-sizing: border-box;
				outline: none;
				/* overflow: auto; */
				min-block-size: 100%;
				white-space: pre-wrap;
				margin: 0;
				font-family: ui-monospace, monospace;
			}

			& ::highlight(heading) {
				color: var(--highlight-heading);
			}
		}

		& .dragger {
			flex-shrink: 0;
			flex-basis: var(--dragger-width);
			cursor: var(--dragger-cursor);
			display: flex;
			gap: 2px;
			align-items: center;
			justify-content: center;
			transition: background-color .2s;
		}

		:root[data-editor-layout="stacked"] & .dragger {
			flex-direction: column;
		}

		& .dragger {
			touch-action: none;

			&:hover {
				background-color: var(--gray-2);
			}

			&::before, &::after {
				content: "";
				--width: 2px;
				--length: 1rem;
				inline-size: var(--width);
				block-size: var(--length);
				border-radius: 1px;
				background-color: var(--color);
				opacity: 50%;
			}
		}

		:root[data-editor-layout="stacked"] & .dragger {
			&::before, &::after {
				inline-size: var(--length);
				block-size: var(--width);
			}
		}

		:root[data-editor-layout="aside"] & .dragger {
			border-start-start-radius: .15rem;
			border-start-end-radius: .15rem;
		}

		& .html-output {
			flex-grow: 1;
			flex-shrink: 1;
			flex-basis: 0;
			font-family: var(--document-font);
			line-height: 1.4;
			font-size: 1rem;
			box-sizing: border-box;

			@media not print {
				:root:not(.print-simulation) & {
					font-size: 1.1rem;
					contain: layout;
					overflow: auto;
					background-color: var(--background);
					padding: 1rem;
					padding-block-start: 2rem;

					& .section {
						content-visibility: auto;
						contain-intrinsic-block-size: auto 10em;
					}
				}
			}
	
			& code {
				white-space: pre-wrap;
				font-family: "FreeMono", "Courier New", ui-monospace, monospace;
				padding-inline: .2em;
				background-color: var(--gray-1);
				font-size: .9em;
			}

			& h1 {
				margin-block-start: 0;
				text-align: center;
			}
		}

		:root[data-engine=blink] & .html-output :is(msqrt > *, mroot > :first-child) {
			padding-block-start: calc(3 * 1em / 16);
			padding-inline: calc(2 * 1em / 16);
		}

		& math[display=block] {
			margin-block: .5em;
		}

		:is(h1, h2, h3, h4, h5, h6) {
			margin-block: .8em .5em;
		}

		& p.bottom-margin {
			margin-block-end: .7em;
		}

		:is(p, h1, h2, h3, h4, h5, h6) {
			white-space: pre-wrap;
		}

		@media not print {
			& .print-header-placeholder, & .print-footer-placeholder, & #headers-and-footers {
				display: none;
			}
		}

		/* :root[data-state=estimating-page-count] & .html-output { */
		:root.print-simulation & {
			& .html-output {
				position: absolute;
				inline-size: var(--page-width);
				block-size: var(--page-height);
				column-width: var(--page-width);
				column-fill: auto;
				column-count: auto;
				padding: 0;
				padding-block-start: var(--page-top-margin);
				padding-block-end: var(--page-bottom-margin);

				& > .section {
					margin-inline: var(--page-inline-margin);
				}
			}
		}

		& #paper-size-measurement {
			position: absolute;
			inline-size: var(--page-width);
			block-size: var(--page-height);

			:root:not(.print-simulation) & {
				display: none;
			}
		}

		@media print {
			& {
				box-sizing: border-box;
				display: table;
				container-type: normal;
				background: none;
			}

			& .dragger, & .text-input {
				display: none;
			}

			& .print-header-placeholder, & .print-footer-placeholder {
				break-inside: avoid-page;
				box-sizing: border-box;
				/* background-color: #00f3; */
			}

			& .print-header-placeholder {
				/* outline: 1px solid blue;
				outline-offset: -2px; */
				display: table-header-group;
				block-size: var(--page-top-margin);
			}

			& .print-footer-placeholder {
				/* outline: 1px solid cyan;
				outline-offset: -2px; */
				display: table-footer-group;
				block-size: var(--page-bottom-margin);
			}

			& .html-output {
				display: table-row-group;
				/* outline: 1px solid lime;
				outline-offset: -6px; */

				& > .section {
					margin-inline: var(--page-inline-margin);
				}

				/* & > * {
					outline: 1px dotted fuchsia;
					outline-offest: 0px;
				} */

				& code {
					background: none;
					padding-inline: .1em;
				}
			}

			& #headers-and-footers {
				pointer-events: none;
				z-index: -1;
				position: absolute;
				inset-block-start: 0;
				inset-inline: 0;
				box-sizing: border-box;
				font-family: var(--document-font);

				& > div {
					/* outline: 1px solid red;
					outline-offset: -4px; */

					box-sizing: border-box;
					block-size: calc(var(--page-height) - var(--page-footer-bottom-offset));
					/* display: flex; */
					/* flex-direction: column; */
					/* justify-content: space-between; */
					break-after: page;
					break-inside: avoid-page;
					/* padding-block-start: var(--page-top-margin); */
					/* padding-inline: var(--page-inline-margin); */
					position: relative;

					& > * {
						pointer-events: all;
						position: absolute;
						inset-inline: 0;
					}

					& > .footer {
						text-align: center;
						inset-block-end: 0;
					}

					& > .header {
						text-align: start;
						inset-block-start: var(--page-header-top-offset);
						margin-inline: var(--page-inline-margin);
						display: flex;
						/* justify-content: space-between; */
						& > * {
							flex-basis: 0;
							flex-grow: 1;
							flex-shrink: 1;

							&:nth-child(2) {
								flex-shrink: 0;
								text-align: center;
							}

							&:nth-child(3) {
								text-align: end;
							}
						}
						border-block-end: 1px solid #555;
						/* font-style: italic; */
					}
				}
			}
		}
	}
</style>